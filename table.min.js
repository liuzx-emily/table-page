'use strict';function Table(c){this.id=c.container_id,this.url=c.url,this.pid=c.pid,this.title_bar=c.title_bar,this.extra=c.extra,this.each_page_data_number=c.each_page_data_number||10,c.auto_index=c.auto_index||{},this.auto_index={_if:c.auto_index._if||!1,_title:c.auto_index._title||'\u5E8F\u53F7',_width:c.auto_index._width||1},c.selection=c.selection||{},this.selection={_type:c.selection._type||'radio',_colomn_shown:c.selection._colomn_shown||!1,_width:c.selection._width||1},this.sorted_colomn=c.sorted_colomn||[],c.detail=c.detail||{},this.detail={_key:c.detail._key,_formatter:c.detail._formatter,_width:c.detail._width||2},this.current_page=1,this.selected=[],this.selected_info=[],this.data=[],this.sum=0,this.container=$('#'+c.container_id),this.container.css('position','relative'),this.add_css(),this.refresh()}Table.prototype={constructor:Table,build:function build(){this.current_page_sort=[];for(var c=0;c<this.data.length;c++)this.current_page_sort.push(c);this.refresh_current_page_range(),this.establish_table_frame();var d=this;setTimeout(function(){d.refresh_radio_and_checkbox(),d.bind_events()},0)},add_css:function add_css(){0===$('style#table-css').length&&$('body').append('\n        <!-- table\u7EC4\u4EF6\u7684css -->\n        <style id="table-css">\n        table.x-table {\n            border-collapse: collapse;\n            width: 100%;\n            background:white;\n        }\n        /*\u81EA\u52A8\u5E8F\u53F7\u3001\u5355\u9009\u3001\u591A\u9009\uFF1A\u6587\u5B57\u5C45\u4E2D*/\n        table.x-table .x-index,table.x-table .x-radio,table.x-table .x-checkbox{\n            text-align: center;\n        }\n        /*th*/\n        table.x-table th{\n            background: #009de1;\n            color: #fff;\n            text-align: center;\n            height: 30px;            \n            font-size: 13px;\n            padding: 0;\n        }\n        /*td*/\n        table.x-table td{\n            color: #646464;\n            text-align: center;\n            border-bottom: 1px dashed #cfcfcf;\n            height: 35px;\n            font-size: 14px;\n            padding: 0;\n            cursor:pointer;\n        }\n        /*\u591A\u9009\u65F6\uFF0C\u8868\u5934\u7684\u5168\u9009\u6309\u94AE*/\n        table.x-table thead input[name="x-input-checkbox-all"]{\n            margin-top:5px;\n        }\n        /*\u589E\u5220\u6539\u6309\u94AE*/\n        table.x-table td a,table.x-table td input{\n            display: inline-block;\n            background: #ff9600;\n            color: #fff;\n            padding: 3px 10px;\n            margin: 0 5px;\n            border-radius: 3px;\n        }\n        /*\u6DFB\u52A0\u4E86\u6392\u5E8F\u529F\u80FD\u7684\u5217\u7684th*/\n        table.x-table th.sorted{\n            cursor: pointer;\n            position:relative;\n        }\n        table.x-table th.sorted>i{\n            position: relative;\n            display: inline-block;\n            width: 16px;\n            height: 18px;\n            top: 7px;\n            left: 5px;\n            background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAkklEQVQoU7WS2Q0CMQxEnzuASoAK2BIoiY4QFcB2AJVAB4PGOFI4JPJDfmzHfo6PBHUkLYCTzYjYWEq6WDQ7feVowesC2r16O/UucwaPAGdgC1yB1QiwByZgB9x+Aq2M6uWlZkmfPfwFAJbAAZhzfN0uvpYEeB+e4nEUcE5PcRoFnsER93fAT/tr5BLra1jNYCsPDaRqRFZ8Da0AAAAASUVORK5CYII=") no-repeat 0 0;\n        }\n        /*  "\u8BE6\u60C5+" \u5217*/\n        table.x-table td.x-detail{\n            font-weight:bold;\n            font-size:20px;\n            color:#097abf;\n        }\n        table.x-table td.x-detail:hover{\n            color:#60c3ff;\n        }\n        /*  "\u8BE6\u60C5+" div*/\n        .x-detail-faketables{\n            position:absolute;\n            z-index:1;\n            left:0;\n            top:0;\n            bottom:35px;\n            display:none;\n            width:100%;\n        }\n        .x-detail-faketables table.x-faketable1{\n\n        }\n        /* \u663E\u793A\u8BE6\u60C5\u7684\u4E00\u884C\u4E0D\u8981cursor */\n        table.x-faketable1 tr.x-tr-detail td{\n            cursor:default;\n        }\n        .x-detail-faketables table.x-faketable2{\n            position:relative;\n            top:-30px;\n            z-index:-1;\n        }\n        /*\u81EA\u52A8\u6362\u884C*/\n        table.x-table th,table.x-table td{\n            word-break:break-all;\n            word-wrap:break-word;\n        }\n        /*\u9009\u4E2D\u6548\u679C*/\n        table.x-table .selected td {\n            background-color: #ffeee2;\n        }\n        /*\u5E95\u90E8\u5206\u9875*/\n        .x-table-page{\n            line-height: 50px;\n            color: #646464;\n            font-size: 13px;\n            position: relative;\n            padding-left:20px;       \n        }\n        .x-table-page .x-table-page-right{\n            position: absolute;\n            right: 0;\n            top: 0;\n        }\n        .x-table-page a{\n            padding: 2px 7px;\n            border: 1px solid #ccc;\n            margin: 0 5px;\n            color: #555;\n            text-decoration: none;\n            vertical-align: top;\n        }\n        .x-table-page input[type="text"]{\n            width: 23px;\n            height: 19px;\n            border: 1px solid #ccc;\n        }\n        </style>')},establish_table_frame:function establish_table_frame(){var c=this,d='\n        <table class="x-table">\n            <thead>\n                <tr>';c.detail._formatter&&(d+='<th width='+c.detail._width+'% class="x-detail"></th>'),d+='\n                    '+(c.auto_index._if?'<th width='+c.auto_index._width+'% class="x-index">'+c.auto_index._title+'</th>':'')+'\n                    '+('radio'===c.selection._type&&!0===c.selection._colomn_shown?'<th width='+c.selection._width+'% class="x-radio"></th>':'')+'\n                    '+('checkbox'===c.selection._type&&!0===c.selection._colomn_shown?'<th width='+c.selection._width+'% class="x-checkbox"><input type="checkbox" name="x-input-checkbox-all"></th>':''),$.each(c.title_bar,function(e,f){('undefined'==typeof f.show||f.show)&&(d+='\n                <th width="'+f.width+'%">'+f.name+'<i></i></th>')}),d+='</tr>\n            </thead>\n            <tbody>',0===c.data.length?d+='<tr><td colspan="999" style="font-weight:bold;">\u6682\u65E0\u6570\u636E!</td></tr>':$.each(c.data,function(e,f){if(d+='\n                    <tr ',$.each(c.pid,function(j,k){d+=' '+k+'='+f[k]}),d+='>',c.detail._formatter){var g;'string'==typeof c.detail._key?g=f[c.detail._key]:(g=[],$.each(c.detail._key,function(j){g.push(f[c.detail._key[j]])}),g=JSON.stringify(g)),d+='<td class=\'x-detail\' data=\''+g+'\' operation>+</td>'}d+='\n                        '+(c.auto_index._if?'<td class="x-index">'+(e+1)+'</td>':'')+'\n                        '+('radio'===c.selection._type&&!0===c.selection._colomn_shown?'\n                        <td class="x-radio">\n                            <input type="radio" name="x-input-radio">\n                        </td>':'')+'\n                        '+('checkbox'===c.selection._type&&!0===c.selection._colomn_shown?'\n                        <td class="x-checkbox">\n                            <input type="checkbox" name="x-input-checkbox">\n                        </td>':''),$.each(c.title_bar,function(j,k){if('undefined'==typeof k.show||k.show){var l=f[k.key];k.formatter&&(l=k.formatter(l)),d+=k.operation?'<td operation '+(k.css?' style='+k.css:'')+'>'+l+'</td>':'<td'+(k.css?' style='+k.css:'')+' title="'+l+'">'+l+'</td>'}}),d+='\n                </tr>\n                '}),d+='</tbody>\n        </table>\n        <div class="x-table-page">\n            <select>\n                <option value="5">5</option>\n                <option value="10">10</option>\n                <option value="20">20</option>\n                <option value="30">30</option>\n                <option value="50">50</option>\n            </select>\n            \u5171'+c.sum+'\u6761\u6570\u636E\uFF08\u5F53\u524D\u7B2C'+c.current_page+'/'+(Math.ceil(c.sum/c.each_page_data_number)||1)+'\u9875\uFF09','checkbox'===c.selection._type&&(d+='\n                <a class="x-table-page-clear-all">\u5168\u90E8\u53D6\u6D88</a>'),d+='\n            <div class="x-table-page-right">\n                <a class="x-table-page-right-prev">&lt;</a>\n                <a class="x-table-page-right-next">&gt;</a>\n                \u7B2C\n                <input type="text" class="x-table-page-right-page">\u9875\n                <a class="x-table-page-right-jump">\u8F6C\u5230</a>\n            </div>\n        </div>',c.detail._formatter&&(d+='\n            <div class="x-detail-faketables">\n                <table class="x-table x-faketable1"></table>             \n                <table class="x-table x-faketable2"></table>             \n            </div>'),c.container.html(d),c.container.find('.x-table-page select option[value='+c.each_page_data_number+']').prop('selected','true')},bind_events:function bind_events(){var c=this;switch(c.container.find('.x-table-page').css('paddingTop','0px'),c.selection._type){case'radio':c.container.find('>table td:not(\'[operation]\')').click(function(){var g=this,j={index:c.current_page_sort[$(g).parents('tr').index()]+c.current_page_min};$.each(c.pid,function(k,l){j[l]=$(g).parents('tr').attr(l)}),c.selected_info=[j],c.selected=[j.index],c.refresh_radio_and_checkbox()});break;case'checkbox':if(c.container.find('>table td:not(\'[operation]\')').click(function(){var g=this,j={index:c.current_page_sort[$(g).parents('tr').index()]+c.current_page_min};if($.each(c.pid,function(l,m){j[m]=$(g).parents('tr').attr(m)}),-1!==$.inArray(j.index,c.selected)){var k=$.inArray(j.index,c.selected);c.selected.splice(k,1),c.selected_info.splice(k,1)}else c.selected.push(j.index),c.selected_info.push(j);c.refresh_radio_and_checkbox()}),c.selection._colomn_shown){var d=this.container.find('>table input[name="x-input-checkbox-all"]'),e=this.container.find('>table input[name="x-input-checkbox"]');d.click(function(){var g=d.prop('checked');e.each(function(j,k){$(k).prop('checked')!==g&&$(k).trigger('click')})})}break;default:}var f=0;c.auto_index._if&&f++,'radio'===c.selection._type&&c.selection._colomn_shown?f++:'checkbox'===c.selection._type&&c.selection._colomn_shown&&f++,c.detail._formatter&&f++,$.each(c.sorted_colomn,function(g,j){c.container.find('>table th').eq(j+f-1).attr('sort_method','original'),c.container.find('>table th').eq(j+f-1).addClass('sorted'),c.container.find('>table th').eq(j+f-1).click(function(){var k=c.current_page_sort;c.current_page_sort=[];var l=$(this).index()-f,m=[];$.each(c.data,function(r,s){var t=c.title_bar[l].key,u=s[t];m.push(u)});var n=m.concat([]);'original'===$(this).attr('sort_method')?(m.sort(function(r,s){return /\d+/.test(r)&&/\d+/.test(s)?parseInt(r)-parseInt(s):r>s}),$.each(m,function(r,s){$.each(n,function(u,v){if(s===v&&-1===$.inArray(u,c.current_page_sort))return c.current_page_sort.push(u),!1})}),$(this).attr('sort_method','asend')):'asend'===$(this).attr('sort_method')?(m.sort(function(r,s){return /\d+/.test(r)&&/\d+/.test(s)?parseInt(s)-parseInt(r):s>r}),$.each(m,function(r,s){$.each(n,function(u,v){if(s===v&&-1===$.inArray(u,c.current_page_sort))return c.current_page_sort.push(u),!1})}),$(this).attr('sort_method','desend')):($.each(m,function(r){c.current_page_sort.push(r)}),$(this).attr('sort_method','original'));for(var q,o=[],p=0;p<c.data.length;p++)q=$.inArray(c.current_page_sort[p],k),o.push(c.container.find('>table tbody tr').eq(q));c.container.find('>table tbody').html(),$.each(o,function(r,s){c.container.find('>table tbody').append(s)}),c.container.find('>table td.x-index').each(function(r,s){$(s).html(r+1)})})}),c.container.find('>table tbody td.x-detail').click(function(){c.establish_faketable_frame(this)}),c.container.find('.x-table-page select').change(function(){c.each_page_data_number=parseInt($(this).val()),c.current_page=1,c.page_change()}),c.container.find('.x-table-page-right-prev').click(function(){1===c.current_page?alert('\u5F53\u524D\u9875\u662F\u7B2C\u4E00\u9875'):(c.current_page--,c.page_change())}),c.container.find('.x-table-page-right-next').click(function(){var g=Math.ceil(c.sum/c.each_page_data_number);0===g&&(g=1),c.current_page===g?alert('\u5F53\u524D\u9875\u662F\u6700\u540E\u4E00\u9875'):(c.current_page++,c.page_change())}),c.container.find('.x-table-page-right-jump').click(function(){var g=parseInt(c.container.find('.x-table-page-right-page').val()),j=Math.ceil(c.sum/c.each_page_data_number);0===j&&(j=1),1<=g&&g<=j?g!==c.current_page&&(c.current_page=g,c.page_change()):alert('\u65E0\u6548\u8F93\u5165\uFF0C\u9875\u7801\u8303\u56F4\uFF1A[1,'+j+']')}),c.container.find('.x-table-page-clear-all').click(function(){c.clear_all()})},establish_faketable_frame:function establish_faketable_frame(c){var d=this,e=$(c).parents('tr').index();d.container.find('.x-detail-faketables').css('display','block');var f='';f+=d.container.find('>table thead').prop('outerHTML'),f+='<tbody>',$.each(d.container.find('>table tbody tr'),function(l,m){l<=e&&(f+=$(m).prop('outerHTML'))});var g=$(c).attr('data'),j;g=JSON.parse(g),j=d.detail._formatter.apply(this,g),f+='\n                    <tr class="x-tr-detail">\n                        <td></td>\n                        <td colspan="999">'+j+'</td>\n                    </tr>',f+='</tbody>',d.container.find('.x-faketable1').html(f);var k='';k+=d.container.find('>table thead').prop('outerHTML'),k+='<tbody>',$.each(d.container.find('>table tbody tr'),function(l,m){l>e&&(k+=$(m).prop('outerHTML'))}),k+='</tbody>',d.container.find('.x-faketable2').html(k),d.f_ie_num=e,d.f_ie_obj=c,setTimeout(function(){d.container.find('.x-faketable1 td.x-detail:last').html('-');var l=d.container.find('.x-faketable1 tr:last').height();d.container.find('.x-table-page').css('paddingTop',l+'px'),d.bind_fake_events()},0)},bind_fake_events:function bind_fake_events(){var c=this,d;c.container.find('.x-faketable1 td:not([operation],:last)').off(),c.container.find('.x-faketable1 td:not([operation],:last)').click(function(){d=$(this).parents('tr').index(),c.container.find('>table tbody tr').eq(d).find('td:not(\'[operation]\')').eq(0).trigger('click'),c.establish_faketable_frame(c.f_ie_obj)}),c.container.find('.x-faketable2 td:not([operation])').off(),c.container.find('.x-faketable2 td:not([operation])').click(function(){d=$(this).parents('tr').index()+c.f_ie_num+1,c.container.find('>table tbody tr').eq(d).find('td:not(\'[operation]\')').eq(0).trigger('click'),c.establish_faketable_frame(c.f_ie_obj)}),c.container.find('.x-faketable1 th.sorted').off('click'),c.container.find('.x-faketable1 th.sorted').click(function(){d=$(this).index(),c.container.find('>table th.sorted').eq(d).trigger('click'),c.container.find('.x-detail-faketables').html(),c.container.find('.x-detail-faketables').css('display','none'),c.container.find('.x-table-page').css('paddingTop','0px')}),c.container.find('.x-faketable1 td.x-detail').off('click'),c.container.find('.x-faketable1 td.x-detail').click(function(){if(d=$(this).parents('tr').index(),d===c.f_ie_num)c.container.find('.x-detail-faketables').html(),c.container.find('.x-detail-faketables').css('display','none'),c.container.find('.x-table-page').css('paddingTop','0px');else{c.container.find('>table td.x-detail').eq(d).trigger('click');var e=c.container.find('>table td.x-detail').eq(d);c.establish_faketable_frame(e)}}),c.container.find('.x-faketable2 td.x-detail').off('click'),c.container.find('.x-faketable2 td.x-detail').click(function(){if(d===c.f_ie_num)c.container.find('.x-detail-faketables').html(),c.container.find('.x-detail-faketables').css('display','none');else{d=$(this).parents('tr').index()+c.f_ie_num+1,c.container.find('>table td.x-detail').eq(d).trigger('click');var e=c.container.find('>table td.x-detail').eq(d);c.establish_faketable_frame(e)}})},refresh_radio_and_checkbox:function refresh_radio_and_checkbox(){if(this.container.find('tbody tr').removeClass('selected'),'radio'===this.selection._type&&(this.container.find('input[name="x-input-radio"]').prop('checked',!1),this.selected[0]>=this.current_page_min&&this.selected[0]<=this.current_page_max)){var c=this.selected[0]-this.current_page_min;c=$.inArray(c,this.current_page_sort),this.container.find('input[name="x-input-radio"]').eq(c).prop('checked',!0),this.container.find('tbody tr').eq(c).addClass('selected')}if('checkbox'===this.selection._type){this.container.find('input[name="x-input-checkbox"]').prop('checked',!1);var d=this;$.each(this.selected,function(e,f){if(f>=d.current_page_min&&f<=d.current_page_max){var g=f-d.current_page_min;g=$.inArray(g,d.current_page_sort),d.container.find('input[name="x-input-checkbox"]').eq(g).prop('checked',!0),d.container.find('tbody tr').eq(g).addClass('selected')}}),this.selection._colomn_shown&&(this.container.find('input[name="x-input-checkbox-all"]').prop('checked',!0),this.container.find('input[name="x-input-checkbox"]').each(function(e,f){!1===$(f).prop('checked')&&d.container.find('input[name="x-input-checkbox-all"]').prop('checked',!1)}))}},refresh_current_page_range:function refresh_current_page_range(){this.current_page_min=(this.current_page-1)*this.each_page_data_number+1,this.current_page_max=this.current_page_min+this.data.length-1},clear_all:function clear_all(){confirm('\u786E\u5B9A\u6E05\u9664\u6240\u6709\u5DF2\u9009\u9879?')&&(this.selected=[],this.selected_info=[],this.refresh_radio_and_checkbox())},refresh:function refresh(c){var d=this;d.current_page=1,c&&(d.extra=c);var e={page:d.current_page,number:d.each_page_data_number};d.extra&&$.extend(e,d.extra),$.ajax({url:d.url,type:'POST',dataType:'json',contentType:'application/json',data:JSON.stringify(e),success:function success(f){d.data=f.data,d.sum=f.count,d.selected=[],d.selected_info=[],d.build()},error:function error(){alert('\u8BFB\u53D6\u5931\u8D25')}})},page_change:function page_change(){var c=this,d={page:c.current_page,number:c.each_page_data_number};c.extra&&$.extend(d,c.extra),$.ajax({url:c.url,type:'POST',dataType:'json',contentType:'application/json',data:JSON.stringify(d),success:function success(e){c.data=e.data,c.sum=e.count,c.build()},error:function error(){alert('\u8BFB\u53D6\u5931\u8D25')}})},get_selected:function get_selected(c){var d=[];return $.each(this.selected_info,function(e,f){d.push(f[c])}),d}};